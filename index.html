<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Annual Leave Bidding System</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        /* ... (keep all existing styles) ... */
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="p-4 md:p-6">
    <div id="app" class="max-w-7xl mx-auto">
        <!-- Loading Screen -->
        <div id="loadingScreen" class="fixed inset-0 bg-white flex flex-col items-center justify-center z-50">
            <div class="loading-spinner mb-4"></div>
            <p class="text-gray-600 font-semibold">Loading system data...</p>
            <p id="loadingMessage" class="text-sm text-gray-500 mt-2"></p>
        </div>

        <!-- Header -->
        <div class="mb-8 text-center fade-in">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">
                Annual Leave Bidding System
            </h1>
            <div id="userInfo" class="hidden flex justify-center items-center gap-4 mt-4">
                <div class="bg-white px-4 py-2 rounded-lg shadow">
                    <span class="text-sm text-gray-600">Logged in as: </span>
                    <span id="currentUserName" class="font-semibold"></span>
                    <span id="userTypeBadge" class="ml-2 px-2 py-1 text-xs rounded"></span>
                </div>
                <button
                    onclick="handleLogout()"
                    class="px-4 py-2 gradient-red text-white rounded-lg hover:shadow-lg font-semibold transition-shadow"
                >
                    Logout
                </button>
            </div>
        </div>

        <!-- Login View (initial view) -->
        <div id="loginView" class="max-w-md mx-auto mt-10 fade-in" style="display: none;">
            <div class="bg-white rounded-xl shadow-xl p-8">
                <h1 class="text-2xl font-bold text-center mb-6 text-blue-600">
                    Annual Leave Bidding System
                </h1>
                
                <div class="mb-6">
                    <label class="block font-semibold mb-3">Login As:</label>
                    <div class="flex gap-4">
                        <button
                            id="loginTypeEmployee"
                            onclick="setLoginType('employee')"
                            class="flex-1 px-4 py-3 rounded-lg font-semibold gradient-blue text-white"
                        >
                            Employee
                        </button>
                        <button
                            id="loginTypePlanner"
                            onclick="setLoginType('planner')"
                            class="flex-1 px-4 py-3 rounded-lg font-semibold bg-gray-200 text-gray-700 hover:bg-gray-300"
                        >
                            Planner
                        </button>
                    </div>
                </div>

                <div id="loginForm">
                    <!-- Employee login fields will be inserted here -->
                </div>

                <button
                    onclick="handleLogin()"
                    class="w-full mt-6 px-6 py-3 gradient-blue text-white rounded-lg hover:shadow-lg font-semibold transition-shadow"
                >
                    Login
                </button>
            </div>
        </div>

        <!-- Planner Navigation -->
        <div id="plannerNav" class="hidden flex justify-center space-x-4 mb-6 fade-in">
            <button onclick="setActiveView('upload')" class="px-4 py-2 rounded-lg font-semibold bg-white text-gray-700 hover:bg-gray-100">
                Upload Data
            </button>
            <button onclick="setActiveView('configureSlots')" class="px-4 py-2 rounded-lg font-semibold bg-white text-gray-700 hover:bg-gray-100">
                Configure Slots
            </button>
            <button onclick="setActiveView('admin')" class="px-4 py-2 rounded-lg font-semibold bg-white text-gray-700 hover:bg-gray-100">
                Admin Panel
            </button>
            <button onclick="publishToCloud()" class="px-4 py-2 gradient-green text-white rounded-lg hover:shadow-lg font-semibold">
                üåê Publish Data
            </button>
            <button onclick="setActiveView('changePlannerPassword')" class="px-4 py-2 rounded-lg font-semibold bg-white text-gray-700 hover:bg-gray-100">
                Change Password
            </button>
        </div>

        <!-- Employee Navigation -->
        <div id="employeeNav" class="hidden flex justify-center space-x-4 mb-6 fade-in">
            <button onclick="setActiveView('employee')" class="px-4 py-2 rounded-lg font-semibold bg-white text-gray-700 hover:bg-gray-100">
                Place Bids
            </button>
            <button onclick="setActiveView('changePassword')" class="px-4 py-2 rounded-lg font-semibold bg-white text-gray-700 hover:bg-gray-100">
                Change Password
            </button>
        </div>

        <!-- Main Content Area -->
        <div id="contentArea"></div>

        <!-- Cloud Publish Modal -->
        <div id="cloudModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl shadow-xl p-6 max-w-md w-full mx-4">
                <h3 class="text-xl font-bold mb-4">üåê Publish System Data</h3>
                <div class="mb-4">
                    <p class="text-sm text-gray-600 mb-2">
                        This will publish your system data to the cloud so all employees can access it.
                    </p>
                    <div class="bg-yellow-50 border border-yellow-200 rounded p-3 mb-3">
                        <p class="text-sm font-semibold text-yellow-800">üìä Current Data Summary:</p>
                        <ul class="text-xs text-yellow-700 mt-1 space-y-1">
                            <li>‚Ä¢ Employees: <span id="employeeCount">0</span></li>
                            <li>‚Ä¢ Slot Configurations: <span id="slotConfigCount">0</span></li>
                            <li>‚Ä¢ Bids: <span id="bidCount">0</span></li>
                            <li>‚Ä¢ Results: <span id="resultCount">0</span></li>
                        </ul>
                    </div>
                </div>
                <div class="flex gap-3">
                    <button
                        onclick="saveToGist()"
                        class="flex-1 px-4 py-2 gradient-green text-white rounded-lg hover:shadow-lg font-semibold"
                    >
                        Publish to GitHub
                    </button>
                    <button
                        onclick="document.getElementById('cloudModal').classList.add('hidden')"
                        class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 font-semibold"
                    >
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Lucide Icons (via CDN) -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <!-- XLSX for Excel processing -->
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>

    <script>
    // Initialize Lucide icons
    lucide.createIcons();

    // ==================== SIMPLIFIED STATE ====================
    let state = {
        loginType: 'employee',
        currentUser: null,
        userType: null,
        verifiedEmployee: null,
        plannerPassword: 'admin123',
        employees: [],
        employeePasswords: {}
    };

    // ==================== SIMPLE RENDER FUNCTIONS ====================
    function renderView() {
        const contentArea = document.getElementById('contentArea');
        contentArea.innerHTML = '';
        
        // Update navigation visibility
        document.getElementById('plannerNav').classList.add('hidden');
        document.getElementById('employeeNav').classList.add('hidden');
        document.getElementById('userInfo').classList.add('hidden');
    }

    function renderLoginView() {
        const loginForm = document.getElementById('loginForm');
        if (state.loginType === 'planner') {
            loginForm.innerHTML = `
                <div>
                    <label class="block font-semibold mb-2">Planner Password:</label>
                    <input
                        type="password"
                        id="loginPassword"
                        class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none"
                        placeholder="Enter planner password"
                    />
                    <div class="mt-2 p-3 bg-purple-50 border border-purple-200 rounded">
                        <p class="text-sm font-semibold text-purple-800">üîë Default Planner Password:</p>
                        <p class="text-lg font-mono font-bold text-purple-900 mt-1">admin123</p>
                    </div>
                </div>
            `;
        } else {
            loginForm.innerHTML = `
                <div class="space-y-4">
                    <div>
                        <label class="block font-semibold mb-2">Employee ID:</label>
                        <input
                            type="text"
                            id="loginId"
                            class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                            placeholder="Enter your ID"
                        />
                    </div>
                    <div>
                        <label class="block font-semibold mb-2">Password:</label>
                        <input
                            type="password"
                            id="loginPassword"
                            class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                            placeholder="Enter your password"
                        />
                        <div class="mt-2 p-3 bg-blue-50 border border-blue-200 rounded">
                            <p class="text-sm font-semibold text-blue-800">üìå Default Password Info:</p>
                            <p class="text-xs text-blue-700 mt-1">Your password is the same as your Employee ID</p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        lucide.createIcons();
    }

    // ==================== EVENT HANDLERS ====================
    function setLoginType(type) {
        state.loginType = type;
        const employeeBtn = document.getElementById('loginTypeEmployee');
        const plannerBtn = document.getElementById('loginTypePlanner');
        
        if (type === 'employee') {
            employeeBtn.className = 'flex-1 px-4 py-3 rounded-lg font-semibold gradient-blue text-white';
            plannerBtn.className = 'flex-1 px-4 py-3 rounded-lg font-semibold bg-gray-200 text-gray-700 hover:bg-gray-300';
        } else {
            employeeBtn.className = 'flex-1 px-4 py-3 rounded-lg font-semibold bg-gray-200 text-gray-700 hover:bg-gray-300';
            plannerBtn.className = 'flex-1 px-4 py-3 rounded-lg font-semibold gradient-purple text-white';
        }
        
        renderLoginView();
    }

    function handleLogin() {
        if (state.loginType === 'planner') {
            const password = document.getElementById('loginPassword').value;
            if (password === state.plannerPassword) {
                state.currentUser = { type: 'planner', name: 'Planner Admin' };
                state.userType = 'planner';
                alert('Welcome, Planner! Demo mode active.');
                // Show demo message
                alert('DEMO MODE: Full system functionality requires complete implementation.\n\nFor now, you can test login functionality.\nThe planner features will be available when all render functions are implemented.');
            } else {
                alert('Incorrect planner password');
            }
        } else {
            const id = document.getElementById('loginId')?.value;
            const password = document.getElementById('loginPassword')?.value;
            
            if (!id || !password) {
                alert('Please enter both ID and password');
                return;
            }
            
            // Demo employee login (accepts any ID with matching password)
            if (password === id) {
                state.currentUser = { 
                    type: 'employee', 
                    id: id,
                    name: 'Demo Employee',
                    department: 'Demo Department'
                };
                state.userType = 'employee';
                state.verifiedEmployee = state.currentUser;
                state.selectedEmployeeId = id;
                alert(`Welcome, Demo Employee! (ID: ${id})`);
                alert('DEMO MODE: Employee bidding system will be available when all render functions are implemented.');
            } else {
                alert('Incorrect password. For demo, use your Employee ID as password.');
            }
        }
        
        // Update UI
        document.getElementById('currentUserName').textContent = state.currentUser?.name || '';
        document.getElementById('userTypeBadge').textContent = state.userType === 'planner' ? 'üëë Planner' : 'üë§ Employee';
        document.getElementById('userTypeBadge').className = `ml-2 px-2 py-1 text-xs rounded ${
            state.userType === 'planner' ? 'bg-purple-100 text-purple-800' : 'bg-blue-100 text-blue-800'
        }`;
        document.getElementById('userInfo').classList.remove('hidden');
    }

    function handleLogout() {
        state.currentUser = null;
        state.userType = null;
        state.verifiedEmployee = null;
        state.selectedEmployeeId = '';
        document.getElementById('userInfo').classList.add('hidden');
        alert('Logged out successfully');
    }

    // ==================== INITIALIZATION ====================
    function init() {
        // Hide loading screen
        setTimeout(() => {
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('loginView').style.display = 'block';
            
            // Set initial login type
            state.loginType = 'employee';
            setLoginType('employee');
            
            // Add global event listeners for Enter key in login
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    handleLogin();
                }
            });
            
            console.log('‚úÖ System ready in demo mode');
        }, 1000);
    }

    // Initialize the application
    init();
</script>
</body>
</html>
